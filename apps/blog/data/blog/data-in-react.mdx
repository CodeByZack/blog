---
title: React 世界里的数据
publishedAt: '2022-11-29 10:11:37'
updatedAt: '2022-11-30 15:52:02'
summary: React 经常听说的状态管理，组件内部状态，还有 React 专有的 state ，其实都是数据，那它们有什么区别呢？
---

## 数据是什么

刚接触 React 的时候，有看到这样一个公式 `UI = fn(Data)` 。当时就觉得这个简洁，易懂。但是后面翻了很久官方文档，也没找到这个公式，
唯一有点关系的是 [Think In React](https://reactjs.org/docs/thinking-in-react.html) 这篇文章里提到的单向数据流。

>The component at the top of the hierarchy will take your data model as a prop. If you make a change to your underlying data model and call root.render() again, the UI will be updated. You can see how your UI is updated and where to make changes. React’s one-way data flow (also called one-way binding) keeps everything modular and fast.

我们这里聊的就是这个公式里的 `data` ，也就是数据。

如果用 JavaScript 的方式，数据就是一个普通对象。

然后结合上面那个公式，整个工作思路大概就类似下面这般，当然细节上肯定不是这样。

```js
// 声明数据对象
const data = { key : 'value' };

// 传递给 React 渲染出 UI
const UI = React(data);

// 修改数据对象
data.key = "hello world";

// 修改数据后，再次调用 React 渲染出 UI
const newUI = React(data);
```

其实我们平时编写的 React 代码，就是在编写 data 和 UI 之间的映射关系。
这样带来的最大好处是，这个映射关系确定后，我们就只需要关注数据了，数据变化了调用函数再次渲染就行了。
这种模式是十分简单而且符合直觉的。这可能也是我喜欢使用 React 的原因之一。

但在使用 React 这么多年后，上面这个公式其实是有适用范围的。

在功能唯一、简单的组件里，或者说页面完全是静态的内容，很少或者没有交互。完全适用于上面这种模式去理解。

但现在的 web 应用都越来越复杂了，逻辑也越来越多了。交互也越来越多，越发复杂。随之而来的数据量是巨大的，随之而来的也就是各种数据管理的库，那是后话了。


## React 把数据放在什么地方的

抛开 Class 组件，React 存放数据最常用的就是 `useState` hook 。对比一下纯 JS 的方式：

```js
// 声明数据
const data = { key : 'value' }; // JS
const [data,setData] = useState({ key: 'value' }); // React

// 修改数据
data.key = "hello world"; // JS
setData({ key : "hello world" }); // React

// 使用数据，都是直接使用 data 就行了
const UI = React(data); // JS & React
```

使用 `useState` 声明的数据，与普通 JS 声明的数据主要区别：

1. `useState` 需要使用专用的函数去修改，普通 JS 对象，直接在原对象上修改就行了。
2. `useState` 使用特有函数去修改数据，会触发 React 进行一次渲染，普通 JS 对象的修改不会。
3. `useState` 只能在组件内部使用，这限制了它的作用域范围，在组件外，你几乎是无法获取这些数据的。
4. 普通 JS 对象即可以在组件内部创建，也可以在组建外部创建，组件外部创建的数据，你可以在任何地方，任何组件里进行访问。

### Context

React 里还有个比较特殊的 `Context` 。我们虽然经常从它里面取数据出来，但其实它并不是存放数据的地方。
它只是提供了一种在组件树层级过多的时候，一种方便获取数据的方法。如果不使用 Context ，我们就只能通过 props 一层层往下传递数据，那是相当烦人的。


```js
const ShareContext = React.createContext();

const SubChildren = ()=>{
    const context = React.useContext(ShareContext);
    return <div>{context}</div>
};

const Children = ()=>{
    return (<SubChildren/>);
};

const App = ()=>{
    return (
        <ShareContext.Provider value="value from context">
            <Children />
        </ShareContext.Provider>
    );
};
```

之所以说它不是存放数据的地方，是因为 `Provider` 上的 `value` 可以是任何值，普通的 JS 对象， React 的 `useState` 里的数据等等。。。

`Context` 只是提供了存放他们，并方便跨层级获取它们的方式。


## 状态管理库需要解决的数据问题

如开头提到过的，我们只针对复杂的应用进行状态管理。通常来说，状态管理库需要解决下面几个问题：

1.**组件之间数据共享问题**。多个组件构成一个应用，组件之间肯定会有需要共享的数据。在 React 官方文档里是建议使用[状态提升](https://zh-hans.reactjs.org/tutorial/tutorial.html#lifting-state-up)来共享数据。
但那也只是针对简单应用，组件层级一两层的情况下。组件层级多了，继续这么做，那会是你的噩梦。


## 触发渲染的数据，不触发渲染的数据
